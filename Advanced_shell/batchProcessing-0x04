#!/bin/bash

# This script fetches data for multiple Pokémon in parallel.

# The list of Pokémon to fetch
POKEMON_LIST=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

# The directory to save the Pokémon data
DATA_DIR="pokemon_data"

# Create the data directory if it doesn't exist
mkdir -p "$DATA_DIR"

# Function to fetch data for a single Pokémon
fetch_pokemon_data() {
  pokemon=$1
  echo "Fetching data for $pokemon..."
  
  # The URL for the Pokémon API
  API_URL="https://pokeapi.co/api/v2/pokemon/$pokemon"
  
  # The output file for the Pokémon data
  OUTPUT_FILE="$DATA_DIR/${pokemon}.json"
  
  # Make the API request and save the data
  if curl -sf "$API_URL" -o "$OUTPUT_FILE"; then
    echo "Saved data to $OUTPUT_FILE ✅"
  else
    echo "Failed to fetch data for $pokemon." >&2
  fi
}

# Trap to clean up background jobs on exit
# This ensures that if the script is interrupted (e.g., with Ctrl+C),
# any running background processes started by this script will be killed.
trap 'kill $(jobs -p) 2>/dev/null' EXIT

# Loop through the Pokémon list and start a background process for each
for pokemon in "${POKEMON_LIST[@]}"; do
  fetch_pokemon_data "$pokemon" &
done

# Display the background jobs that have been started
echo "Running jobs:"
jobs

# Wait for all background processes to complete
wait

echo "All Pokémon data has been fetched."
